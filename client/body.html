<template name="loading">
{{> spinner}}
</template>

<template name="main_layout">
<div id="width" class="{{signed_in}} {{connection_status}} ">
{{#if loading}}
<div id="spinner_box"><div class="inner_tube">
<p>Loading...</p>
</div></div>
{{/if}}
{{> header}}
{{> import_pattern_dialog}}
<div id="connection_status_holder">{{> connection_status}}</div>
<div id="content">{{> import_file_picker}}{{> yield}}</div>
</div>
{{> yield region="footer"}}
</template>

<template name="print_layout">
{{> yield}}
</template>

<template name="header">
<div id="header">{{#if Template.subscriptionsReady}}
  <div class="inner_tube">
<div class="header_left">{{#if equals route_name "user"}}<a href="{{pathFor route='home'}}">Home</a>
{{else}}
{{#if equals route_name "pattern"}}
<a href="{{pathFor route='home'}}">Home</a>
{{#if pattern_exists _id}}{{#if is_weaving}}
<a href="{{pathFor route='pattern'}}" id="stop_weaving">Stop weaving</a>{{else}}
<a href="{{pathFor route='pattern' mode="weaving"}}" id="start_weaving">Start weaving</a>{{/if}}{{/if}}{{/if}}{{/if}}
</div>
<h1><span>{{#if equals route_name "home"}}Twisted Threads
{{else}}
{{#if equals route_name "user"}}{{#if Template.subscriptionsReady}}{{#if user_exists _id}}{{username}}{{else}}User not found{{/if}}{{/if}}
{{else}}
{{#if equals route_name "pattern"}}{{#if Template.subscriptionsReady}}{{#if pattern_exists _id}}{{name}}{{else}}Pattern not found{{/if}}{{/if}}{{/if}}{{/if}}{{/if}}</span></h1>
<div class="header_right">{{> loginButtons}}{{> menu}}</div></div>
{{/if}}</div>
</template>

<template name="menu">
  {{#if show_menu Template.subscriptionsReady route_name _id}}
<div id="menu" class="{{menu_open}}">
<input type="button" id="menu_button" class="menu_button" value="">
<div class="menu_list">{{#if currentUser }}<ul>
{{#if is_file_loading_supported}}<li><a href="#" id="import_pattern" >Import pattern from file</a></li>{{/if}}
</ul>{{/if}}
{{#if Template.subscriptionsReady}}{{#if equals route_name "pattern"}}{{#if pattern_exists _id}}<ul>
<li><a href="{{pathFor route='pattern' mode="print"}}" target="_blank" id="print_pattern" >Printer-friendly pattern</a></li>
{{#if currentUser }}<li><a href="#" id="copy_pattern" >Copy pattern</a></li>
<li><a href="#" id="export_pattern" >Export pattern to JSON</a></li>{{/if}}
</ul>
{{/if}}{{/if}}{{/if}}
</div></div>{{/if}}
</template>

<template name="import_pattern_dialog">
<div id="import_pattern_dialog" class="{{show_import_pattern}}"><div class="inner_tube">
<div class="buttons">
  <input type="button" class="close" value="Close" >
</div>
<h2>Import pattern</h2>
<p>Choose the type of pattern file you want to import.</p>

  <div class="radio_button"><input type="radio" id="json" name="file_type" value="JSON" checked="{{checked "JSON"}}" />
  <label for="json">JSON</label></div>
  <div class="radio_button"><input type="radio" id="gtt" name="file_type" value="GTT" checked="{{checked "GTT"}}" />
  <label for="gtt">GTT</label></div>

<div class="buttons continue_holder">
  <input type="button" class="continue" value="Continue" {{disabled}}>
</div>
</div></div>
</template>

<template name="import_file_picker">
<div id="import_file_holder">
<input type="file" id="file_picker" name="file_picker" />
</div>
</template>

<!--https://github.com/webtempest/meteor-animate-->
<template name="connection_status">
{{#if equals connection_status "trying_to_connect"}}
{{#transition in="slideInDown" out="slideOutUp"}}<div id="connection_status" class="animated out"><div class="text">
Connection lost...trying to reconnect...
</div></div>{{/transition}}
{{/if}}
</template>
