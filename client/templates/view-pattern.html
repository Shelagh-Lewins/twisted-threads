<template name="view_pattern">
{{#if Template.subscriptionsReady}}
{{> pattern_as_text}}

<div class="pattern_info">
{{> editable_field extendContext collection="patterns" property="name" data=name button_text="Edit name"}}

{{#if can_edit_pattern _id}}
{{else}}
<div class="box summary">
<span class="tablets_count" title="{{number_of_tablets}} tablets"><span class="icon"></span>{{number_of_tablets}}</span><a href="{{pathFor route='user' _id=created_by}}"><span class="created_by" title="Created by {{created_by_username}}"><span class="icon"></span>{{created_by_username}}</span></a>
</div>
{{/if}}

{{#if can_edit_pattern _id}}<div class="box private">
<div class="controls"><button class="toggle_private">{{#if private}}Make pattern public{{else}}Make pattern private{{/if}}</button></div>
<div class="content">{{#if private}}Private: nobody else can see this pattern.{{else}}Public: other people can see and weave this pattern but they can't edit or delete it.{{/if}}</div>
</div>{{/if}}

{{> editable_field extendContext collection="patterns" property="description" data=description multiple=true button_text="Edit description" placeholder_text="Tap \"Edit description\" to enter a description"}}

{{#if can_edit_pattern _id}}
<div class="box tags"><span class="text">Tags: </span>{{> tagInput}}</div>
{{else}}
<div class="box tags">{{> tags}}</div>
{{/if}}
</div>

<h2>Weaving Chart</h2>
<div class="pattern_info">
{{> editable_field extendContext collection="patterns" property="weaving_notes" data=weaving_notes multiple=true button_text="Edit weaving notes" placeholder_text="Tap \"Edit weaving notes\" to enter weaving notes"}}
</div>
{{#if can_edit_pattern _id}}
<div id="toolbar" ><div class="inner_tube">
<button id="undo" disabled="{{undo_disabled}}" title="Undo"><img src="{{#if equals undo_disabled "disabled"}}../images/undo_disabled.svg{{else}}../images/undo.svg{{/if}}" width="32" height="32" ></button>
<button id="redo" disabled="{{redo_disabled}}" title="Redo"><img src="{{#if equals redo_disabled "disabled"}}../images/redo_disabled.svg{{else}}../images/redo.svg{{/if}}" width="32" height="32" ></button>
<button id="add_row_at_start" title="Add row at bottom"><img src="../images/row_bottom.svg" width="32" height="32" ></button>
<button id="add_row_at_end" title="Add row at top"><img src="../images/row_top.svg" width="32" height="32" ></button>
<button id="add_tablet_at_start" title="Add tablet at left"><img src="../images/tablet_left.svg" width="32" height="32" ></button>
<button id="add_tablet_at_end" title="Add tablet at right"><img src="../images/tablet_right.svg" width="32" height="32" ></button>
</div></div>{{/if}}
<div class="pattern view {{#if can_edit_pattern _id}}editable{{/if}}">
{{> column_numbers}}
{{#each row_indexes}}
{{> pattern_row}}
{{/each}}{{#if can_remove_tablets}}<div class="row"><span class="spacer"></span><ul>
{{#each tablet_indexes}}
{{> remove_tablet}}
{{/each}}</ul></div>{{/if}}
</div>

<h2>Tablets</h2>
<div class="pattern_info">
  {{> editable_field extendContext collection="patterns" property="threading_notes" data=threading_notes multiple=true button_text="Edit threading notes" placeholder_text="Tap \"Edit threading notes\" to enter threading notes"}}
</div>
<div class="tablets {{#if can_edit_pattern _id}}editable{{/if}}">{{> column_numbers}}
{{#each hole_indexes}}{{> threading_row}}
{{/each}}
{{> orientation}}
</div>
<br/>
<div class="notation">
<img src="../images/tablet_labels.png" alt="Tablet labels" title="Labels and turning direction" width="237" height="148"/>
</div><br/>
{{/if}}
</template>

<template name="pattern_row">
<div class="row">{{> row_number}}<ul>
{{#each weaving_row this}}
{{#with cell_style this}}
{{> pattern_cell}}
{{/with}}
{{/each}}
{{> remove_row}}</ul></div>
</template>

<template name="remove_row">
{{#if can_remove_rows}}<li class="cell no_select remove_row" title="Delete this row (delete cannot be undone)" >X</li>{{/if}}
</template>

<template name="remove_tablet">
<li class="no_select remove_tablet" title="Delete this tablet (delete cannot be undone)" >X</li>
</template>

<template name="threading_row">
<div class="row"><span class="hole_number">{{hole_label this}}</span><ul>{{#each threading_hole this}}
{{#with cell_style}}
{{> pattern_cell}}
{{/with}}-->
{{/each}}</ul></div>
</template>

<template name="styles_palette">{{#if can_edit_pattern _id}}
<div id="styles_palette" class="{{#if single_column}}single_column{{/if}} {{editing_text}}">
<div class="edit_style {{editing_style}}">
 <h2>Background</h2>
<div class="colorpicker_holder"><input type="text" id="background_colorpicker"></div>
<h2>Line</h2>
<div class="colorpicker_holder"><input type="text" id="line_colorpicker"></div>
<div class="forward_stroke {{forward_stroke_on}}"></div>
<div class="backward_stroke {{backward_stroke_on}}"></div>
</div>
<div class="styles">{{#if single_column}}<div class="pagination">
<ul><li class="page_1 no_select {{is_selected_style_palette 1}}"><a href="#">Page 1</a></li><li class="page_2 no_select {{is_selected_style_palette 2}}"><a href="#">Page 2</a></li></ul></div>{{/if}}
<input type="button" id="edit_style_button" class=" {{editing_style}}" value="Edit style"><div class="box {{style_page_class}}">{{#each style_pages}}<ul class="row">{{#each styles this}}{{#with cell_style}}{{> style_cell}}{{/with}}{{/each}}</ul>{{/each}}
</div></div></div>
{{/if}}</template>

<template name="style_cell">
<li class="cell {{is_selected_style style}} {{forward_stroke}} {{backward_stroke}}" style="background-color: {{background_color}}"><span class="line_forward" style="background-color: {{line_color}}"></span><span class="line_backward" style="background-color: {{line_color}}"></span></li>
</template>

<template name="orientation">
<div class="row orientation {{#if can_edit_pattern _id}}editable{{/if}}"><span class="spacer"></span><ul>
{{#each tablet_orientation}}
<li class="no_select {{style_orientation orientation}}" title="Click to change orientation"><span class="line"></span></li>
{{/each}}</ul></div>
<div class="hint"><span class="spacer"></span>Slope of line = angle of tablet viewed from above</div>
</template>

<template name="pattern_not_found">
<h2>Pattern not found: {{id}}</h2>
</template>
